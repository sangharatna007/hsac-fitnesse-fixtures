<html><head><title>HsacExamples.SlimTests.BrowserTests.UseCookiesForHttpTest</title><meta http-equiv='Content-Type' content='text/html;charset=UTF-8'/><link rel='stylesheet' type='text/css' href='css/fitnesse.css'/><script src='javascript/jquery-1.11.3.min.js' type='text/javascript'></script><script src='javascript/fitnesse.js' type='text/javascript'></script></head><body><header><h2>HsacExamples.SlimTests.BrowserTests.UseCookiesForHttpTest</h2></header><article><br/>By taking cookies from a browser's session we can test REST services that are only accessible in after (complex) login procedures.<br/><br/>Here we don't actually test a login procedure. We just validate cookies are copied and subsequent requests by http test can change the cookies stored.<br/><br/>First http test on its own: 2nd request (with cookies from 1st) gets same cookie value.<br/><br/><table>
	<tr class="slimRowTitle">
		<td>script</td>
		<td colspan="3"><span class="pass">http test</span></td>
	</tr>
	<tr class="slimRowColor2">
		<td>set store cookies</td>
		<td colspan="3">true</td>
	</tr>
	<tr class="slimRowColor8">
		<td><span class="pass">get from</span></td>
		<td colspan="3"><a href="https://mail.live.com/default.aspx">https://mail.live.com/default.aspx</a></td>
	</tr>
	<tr class="slimRowColor0">
		<td>check</td>
		<td>response status</td>
		<td colspan="2"><span class="pass">200</span></td>
	</tr>
	<tr class="slimRowColor9">
		<td>show</td>
		<td colspan="3">response headers</td>
	<td><table class="hash_table">
	<tr class="hash_row">
		<td class="hash_key">Cache-Control</td>
		<td class="hash_value">max-age=0</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">Content-Length</td>
		<td class="hash_value">15703</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">Content-Type</td>
		<td class="hash_value">text/html; charset=utf-8</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">Expires</td>
		<td class="hash_value">Sun, 19 Feb 2017 08:48:18 GMT</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">Server</td>
		<td class="hash_value">Microsoft-IIS/8.5</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">P3P</td>
		<td class="hash_value">CP="DSP CUR OTPi IND OTRi ONL FIN"</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">Set-Cookie</td>
		<td class="hash_value">[uaid=2439f64931294060bd4dba75ed679e8f; domain=login.live.com;secure= ;path=/;HTTPOnly= ;version=1, MSPRequ=lt=1487494158&amp;co=1&amp;id=64855; secure= ;path=/;HTTPOnly=;version=1, MSPOK=$uuid-5324096b-6405-40da-9a46-ee2844eeb41e; domain=login.live.com;secure= ;path=/;HTTPOnly= ;version=1]</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-Frame-Options</td>
		<td class="hash_value">deny</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-Content-Type-Options</td>
		<td class="hash_value">nosniff</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">Strict-Transport-Security</td>
		<td class="hash_value">max-age=31536000</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-XSS-Protection</td>
		<td class="hash_value">1; mode=block</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">Date</td>
		<td class="hash_value">Sun, 19 Feb 2017 08:49:17 GMT</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">Connection</td>
		<td class="hash_value">close</td>
	</tr>
</table></td></tr>
	<tr class="slimRowColor9">
		<td>show</td>
		<td colspan="3">cookie values</td>
	<td><table class="hash_table">
	<tr class="hash_row">
		<td class="hash_key">MSPOK</td>
		<td class="hash_value">$uuid-5324096b-6405-40da-9a46-ee2844eeb41e</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">MSPRequ</td>
		<td class="hash_value">lt=1487494158&amp;co=1&amp;id=64855</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">uaid</td>
		<td class="hash_value">2439f64931294060bd4dba75ed679e8f</td>
	</tr>
</table></td></tr>
	<tr class="slimRowColor9">
		<td>check not</td>
		<td>cookie value</td>
		<td>uaid</td>
		<td><span class="pass">null</span></td>
	</tr>
	<tr class="slimRowColor5">
		<td>$uaid1&lt;-[2439f64931294060bd4dba75ed679e8f]</td>
		<td>cookie value</td>
		<td colspan="2">uaid</td>
	</tr>
	<tr class="slimRowColor8">
		<td>note</td>
		<td colspan="3">see that we get same cookie value again</td>
	</tr>
	<tr class="slimRowColor8">
		<td><span class="pass">get from</span></td>
		<td colspan="3"><a href="https://mail.live.com/default.aspx">https://mail.live.com/default.aspx</a></td>
	</tr>
	<tr class="slimRowColor0">
		<td>check</td>
		<td>response status</td>
		<td colspan="2"><span class="pass">200</span></td>
	</tr>
	<tr class="slimRowColor9">
		<td>show</td>
		<td colspan="3">response headers</td>
	<td><table class="hash_table">
	<tr class="hash_row">
		<td class="hash_key">Cache-Control</td>
		<td class="hash_value">max-age=0</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">Content-Length</td>
		<td class="hash_value">15647</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">Content-Type</td>
		<td class="hash_value">text/html; charset=utf-8</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">Expires</td>
		<td class="hash_value">Sun, 19 Feb 2017 08:48:19 GMT</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">Server</td>
		<td class="hash_value">Microsoft-IIS/8.5</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">P3P</td>
		<td class="hash_value">CP="DSP CUR OTPi IND OTRi ONL FIN"</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">Set-Cookie</td>
		<td class="hash_value">[uaid=2439f64931294060bd4dba75ed679e8f; domain=login.live.com;secure= ;path=/;HTTPOnly= ;version=1, MSPRequ=lt=1487494159&amp;id=64855&amp;co=2; secure= ;path=/;HTTPOnly=;version=1, MSPOK=$uuid-5324096b-6405-40da-9a46-ee2844eeb41e$uuid-cf6d9d3f-b431-4955-9304-44a3a107b441; domain=login.live.com;secure= ;path=/;HTTPOnly= ;version=1]</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-Frame-Options</td>
		<td class="hash_value">deny</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-Content-Type-Options</td>
		<td class="hash_value">nosniff</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">Strict-Transport-Security</td>
		<td class="hash_value">max-age=31536000</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-XSS-Protection</td>
		<td class="hash_value">1; mode=block</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">Date</td>
		<td class="hash_value">Sun, 19 Feb 2017 08:49:18 GMT</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">Connection</td>
		<td class="hash_value">close</td>
	</tr>
</table></td></tr>
	<tr class="slimRowColor9">
		<td>show</td>
		<td colspan="3">cookie values</td>
	<td><table class="hash_table">
	<tr class="hash_row">
		<td class="hash_key">MSPOK</td>
		<td class="hash_value">$uuid-5324096b-6405-40da-9a46-ee2844eeb41e$uuid-cf6d9d3f-b431-4955-9304-44a3a107b441</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">MSPRequ</td>
		<td class="hash_value">lt=1487494159&amp;id=64855&amp;co=2</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">uaid</td>
		<td class="hash_value">2439f64931294060bd4dba75ed679e8f</td>
	</tr>
</table></td></tr>
	<tr class="slimRowColor0">
		<td>check</td>
		<td>cookie value</td>
		<td>uaid</td>
		<td><span class="pass">$uaid1-&gt;[2439f64931294060bd4dba75ed679e8f]</span></td>
	</tr>
</table>
<br/>Then two requestes one by browser and one by plain http: again same cookie on 2nd request (but not the same as first table).<br/><br/><table>
	<tr class="slimRowTitle">
		<td>script</td>
		<td colspan="3"><span class="pass">browser test</span></td>
	</tr>
	<tr class="slimRowColor4">
		<td><span class="pass">open</span></td>
		<td colspan="3"><a href="https://mail.live.com/default.aspx">https://mail.live.com/default.aspx</a></td>
	</tr>
	<tr class="slimRowColor6">
		<td>$uaid&lt;-[da832ae54e504bc4a04290f3a07e36da]</td>
		<td>cookie value</td>
		<td colspan="2">uaid</td>
	</tr>
	<tr class="slimRowColor8">
		<td>note</td>
		<td colspan="3">see that we get different cookie value</td>
	</tr>
	<tr class="slimRowColor9">
		<td>check not</td>
		<td>cookie value</td>
		<td>uaid</td>
		<td><span class="pass">$uaid1</span></td>
	</tr>
	<tr class="slimRowColor3">
		<td>$ck&lt;-[G1487494159668]</td>
		<td>cookie value</td>
		<td colspan="2">CkTst</td>
	</tr>
	<tr class="slimRowColor7">
		<td>$pok&lt;-[$uuid-e53b6834-81e4-4cf0-9813-5ab4a82a52bf]</td>
		<td>cookie value</td>
		<td colspan="2">MSPOK</td>
	</tr>
	<tr class="slimRowColor2">
		<td>$requ&lt;-[lt=1487494160&amp;co=1&amp;id=64855]</td>
		<td>cookie value</td>
		<td colspan="2">MSPRequ</td>
	</tr>
	<tr class="slimRowColor5">
		<td>$loc&lt;-[https://login.live.com/login.srf?wa=wsignin1.0&amp;rpsnv=13&amp;ct=1487494160&amp;rver=6.4.6456.0&amp;wp=MBI_SSL_SHARED&amp;wreply=https:%2F%2Fmail.live.com%2Fdefault.aspx%3Frru%3Dinbox&amp;lc=1033&amp;id=64855&amp;mkt=en-us&amp;cbcxt=mai]</td>
		<td colspan="3">location</td>
	</tr>
</table>
<br/>Copying from browser's cookie store implicitly ensures cookies are stored/sent.<br/><br/><table>
	<tr class="slimRowTitle">
		<td>script</td>
		<td colspan="3"><span class="pass">http test</span></td>
	</tr>
	<tr class="slimRowColor8">
		<td>note</td>
		<td colspan="3">we set version information for cookies (Selenium cannot supply it)</td>
	</tr>
	<tr class="slimRowColor8">
		<td colspan="4">copy browser cookies</td>
	</tr>
	<tr class="slimRowColor0">
		<td>check</td>
		<td>cookie value</td>
		<td>uaid</td>
		<td><span class="pass">$uaid-&gt;[da832ae54e504bc4a04290f3a07e36da]</span></td>
	</tr>
	<tr class="slimRowColor0">
		<td>check</td>
		<td>cookie value</td>
		<td>CkTst</td>
		<td><span class="pass">$ck-&gt;[G1487494159668]</span></td>
	</tr>
	<tr class="slimRowColor0">
		<td>check</td>
		<td>cookie value</td>
		<td>MSPOK</td>
		<td><span class="pass">$pok-&gt;[$uuid-e53b6834-81e4-4cf0-9813-5ab4a82a52bf]</span></td>
	</tr>
	<tr class="slimRowColor0">
		<td>check</td>
		<td>cookie value</td>
		<td>MSPRequ</td>
		<td><span class="pass">$requ-&gt;[lt=1487494160&amp;co=1&amp;id=64855]</span></td>
	</tr>
	<tr class="slimRowColor8">
		<td><span class="pass">get from</span></td>
		<td colspan="3">$loc->[https://login.live.com/login.srf?wa=wsignin1.0&rpsnv=13&ct=1487494160&rver=6.4.6456.0&wp=MBI_SSL_SHARED&wreply=https:%2F%2Fmail.live.com%2Fdefault.aspx%3Frru%3Dinbox&lc=1033&id=64855&mkt=en-us&cbcxt=mai]</td>
	</tr>
	<tr class="slimRowColor0">
		<td>check</td>
		<td>response status</td>
		<td colspan="2"><span class="pass">200</span></td>
	</tr>
	<tr class="slimRowColor9">
		<td>show</td>
		<td colspan="3">response headers</td>
	<td><table class="hash_table">
	<tr class="hash_row">
		<td class="hash_key">Cache-Control</td>
		<td class="hash_value">max-age=0</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">Content-Length</td>
		<td class="hash_value">15643</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">Content-Type</td>
		<td class="hash_value">text/html; charset=utf-8</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">Expires</td>
		<td class="hash_value">Sun, 19 Feb 2017 08:48:22 GMT</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">Server</td>
		<td class="hash_value">Microsoft-IIS/8.5</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">P3P</td>
		<td class="hash_value">CP="DSP CUR OTPi IND OTRi ONL FIN"</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">Set-Cookie</td>
		<td class="hash_value">[uaid=da832ae54e504bc4a04290f3a07e36da; domain=login.live.com;secure= ;path=/;HTTPOnly= ;version=1, MSPRequ=lt=1487494162&amp;id=64855&amp;co=2; secure= ;path=/;HTTPOnly=;version=1, MSPOK=$uuid-e53b6834-81e4-4cf0-9813-5ab4a82a52bf$uuid-8e24aa99-7ae7-4a83-86c7-5113c703a044; domain=login.live.com;secure= ;path=/;HTTPOnly= ;version=1]</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-Frame-Options</td>
		<td class="hash_value">deny</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-Content-Type-Options</td>
		<td class="hash_value">nosniff</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">Strict-Transport-Security</td>
		<td class="hash_value">max-age=31536000</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">X-XSS-Protection</td>
		<td class="hash_value">1; mode=block</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">Date</td>
		<td class="hash_value">Sun, 19 Feb 2017 08:49:21 GMT</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">Connection</td>
		<td class="hash_value">close</td>
	</tr>
</table></td></tr>
	<tr class="slimRowColor9">
		<td>show</td>
		<td colspan="3">cookie values</td>
	<td><table class="hash_table">
	<tr class="hash_row">
		<td class="hash_key">CkTst</td>
		<td class="hash_value">G1487494159668</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">MSPOK</td>
		<td class="hash_value">$uuid-e53b6834-81e4-4cf0-9813-5ab4a82a52bf$uuid-8e24aa99-7ae7-4a83-86c7-5113c703a044</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">MSPRequ</td>
		<td class="hash_value">lt=1487494162&amp;id=64855&amp;co=2</td>
	</tr>
	<tr class="hash_row">
		<td class="hash_key">uaid</td>
		<td class="hash_value">da832ae54e504bc4a04290f3a07e36da</td>
	</tr>
</table></td></tr>
	<tr class="slimRowColor8">
		<td>note</td>
		<td colspan="3">see that we get same cookie value as we copied from browser</td>
	</tr>
	<tr class="slimRowColor0">
		<td>check</td>
		<td>cookie value</td>
		<td>uaid</td>
		<td><span class="pass">$uaid-&gt;[da832ae54e504bc4a04290f3a07e36da]</span></td>
	</tr>
</table>
<br/></article></body></html>